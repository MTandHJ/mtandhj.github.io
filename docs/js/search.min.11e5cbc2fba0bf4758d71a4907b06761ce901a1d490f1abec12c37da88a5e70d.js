var fuse,searchVisible=!1,firstRun=!0,list=document.getElementById("searchResults"),first=list.firstChild,last=list.lastChild,maininput=document.getElementById("searchInput"),resultsAvailable=!1;const CONSTANTS={MAX_RESULTS:5,CONTEXT_LENGTH:50,SHORT_WORD_LENGTH:2,SEARCH_THRESHOLD:.4};document.addEventListener("click",e=>{const n=document.getElementById("fastSearch"),s=document.getElementById("search-click"),t=e.target;s===t||s.contains(t)?showSearchInput():n===t||n.contains(t)||searchVisible&&(n.style.display="none",searchVisible=!1)}),document.addEventListener("keydown",function(e){if(e.metaKey&&e.which===191&&showSearchInput(),e.keyCode===27&&searchVisible&&(document.getElementById("fastSearch").style.display="none",document.activeElement.blur(),searchVisible=!1),searchVisible&&resultsAvailable){const t=Array.from(document.querySelectorAll("#searchResults li a")),n=t.indexOf(document.activeElement);e.keyCode===40&&(e.preventDefault(),n===-1?t[0]?.focus():n<t.length-1&&t[n+1].focus())}if(searchVisible&&resultsAvailable){const n=Array.from(document.querySelectorAll("#searchResults li a")),t=n.indexOf(document.activeElement);e.keyCode===38&&(e.preventDefault(),t===0?maininput.focus():t>0&&n[t-1].focus())}}),document.getElementById("searchInput").onkeyup=function(){executeSearch(this.value)};function showSearchInput(){firstRun&&(loadSearch(),firstRun=!1),searchVisible?(document.getElementById("fastSearch").style.display="none",document.activeElement.blur(),searchVisible=!1):(document.getElementById("fastSearch").style.display="block",document.getElementById("searchInput").focus(),searchVisible=!0)}function fetchJSONFile(e,t){const n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===4&&n.status===200)try{const e=JSON.parse(n.responseText);t&&t(e)}catch(e){console.error("Error parsing JSON:",e)}},n.open("GET",e),n.send()}function loadSearch(){fetchJSONFile("/index.json",function(e){const t={includeMatches:!0,shouldSort:!0,ignoreLocation:!0,threshold:CONSTANTS.SEARCH_THRESHOLD,minMatchCharLength:1,keys:[{name:"title",weight:1},{name:"content",weight:.6}],useExtendedSearch:!0,findAllMatches:!0,distance:200};fuse=new Fuse(e,t)})}function containsChinese(e){return/[\u4e00-\u9fa5]/.test(e)}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function cleanText(e){return e?e.replace(/\$\$[\s\S]*?\$\$/g,"").replace(/\$.*?\$/g,"").replace(/\\\[[\s\S]*?\\\]/g,"").replace(/\\\(.*?\\\)/g,"").replace(/<img[^>]*>/g,"").replace(/<[^>]*>/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/\\[a-zA-Z]+\{.*?\}/g,"").replace(/[_^\\{}]/g,"").replace(/\s+/g," ").trim():""}function highlightText(e,t){if(!e||!t)return e;const n=t.toLowerCase();if(n.length<=CONSTANTS.SHORT_WORD_LENGTH||containsChinese(n)){const t=new RegExp(escapeRegExp(n),"gi");return e.replace(t,e=>`<span class="search-highlight">${e}</span>`)}const s=[escapeRegExp(n),escapeRegExp(n)+"-\\w+","\\w+-"+escapeRegExp(n)],o=new RegExp(s.join("|"),"gi");return e.replace(o,e=>`<span class="search-highlight">${e}</span>`)}function extractContext(e,t){if(!e||!t)return"";const s=t.toLowerCase(),a=e.toLowerCase(),n=a.indexOf(s);if(n===-1)return e.slice(0,100)+" ...";const o=Math.max(0,n-CONSTANTS.CONTEXT_LENGTH),i=Math.min(e.length,n+s.length+CONSTANTS.CONTEXT_LENGTH);return(o>0?"... ":"")+e.slice(o,i).trim()+(i<e.length?" ...":"")}function executeSearch(e){if(!e){document.getElementById("searchResults").setAttribute("style","");return}const t=e.toLowerCase(),n=fuse.search(t);let s="";if(n.length===0)resultsAvailable=!1,s='<li class="noSearchResult">无结果</li>';else{resultsAvailable=!0;const o=new Set;let i=0;const a=n.filter(e=>{const n=cleanText(e.item.title).toLowerCase(),s=e.item.content?cleanText(e.item.content).toLowerCase():"";return t.length<=CONSTANTS.SHORT_WORD_LENGTH||containsChinese(t)?n.includes(t)||s.includes(t):n.includes(t)||s.includes(t)||n.includes(t+"-")||s.includes(t+"-")||n.includes("-"+t)||s.includes("-"+t)}),r=a.sort((e,n)=>{const s=cleanText(e.item.title).toLowerCase(),o=cleanText(n.item.title).toLowerCase();if(t.length<=CONSTANTS.SHORT_WORD_LENGTH||containsChinese(t)){{const e=s.includes(t),n=o.includes(t);if(e!==n)return e?-1:1}}else{const e=s.includes(t),i=o.includes(t);if(e!==i)return e?-1:1;const n=s.includes(t+"-")||s.includes("-"+t),a=o.includes(t+"-")||o.includes("-"+t);if(n!==a)return n?-1:1}return 0});for(const n of r){if(i>=CONSTANTS.MAX_RESULTS)break;const a=n.item.permalink;if(o.has(a))continue;o.add(a),i++;let c=cleanText(n.item.title),t="";for(const s of n.matches)if(s.key==="title")c=highlightText(c,e);else if(s.key==="content"){const n=cleanText(s.value);t=extractContext(n,e),t=highlightText(t,e)}s+=`<li><a href="${a}" tabindex="0" class="search-result-item">`+`<span class="title">${c}</span>`+(t?`<br /><span class="sc">${t}</span>`:"")+`</a></li>`}}document.getElementById("searchResults").setAttribute("style","display: block;"),document.getElementById("searchResults").innerHTML=s,n.length>0&&(first=list.firstChild.firstElementChild,last=list.lastChild.firstElementChild)}