var fuse,searchVisible=!1,firstRun=!0,list=document.getElementById("searchResults"),first=list.firstChild,last=list.lastChild,maininput=document.getElementById("searchInput"),resultsAvailable=!1;document.addEventListener("click",e=>{var n=document.getElementById("fastSearch"),s=document.getElementById("search-click"),t=e.target;s==t||s.contains(t)?showSearchInput():n==t||n.contains(t)||searchVisible&&(n.style.display="none",searchVisible=!1)}),document.addEventListener("keydown",function(e){if(e.metaKey&&e.which===191&&showSearchInput(),e.keyCode==27&&searchVisible&&(document.getElementById("fastSearch").style.display="none",document.activeElement.blur(),searchVisible=!1),e.keyCode==40&&searchVisible&&resultsAvailable){e.preventDefault();const t=Array.from(document.querySelectorAll("#searchResults li a")),n=t.indexOf(document.activeElement);n===-1?t[0]?.focus():n<t.length-1&&t[n+1].focus()}if(e.keyCode==38&&searchVisible&&resultsAvailable){e.preventDefault();const n=Array.from(document.querySelectorAll("#searchResults li a")),t=n.indexOf(document.activeElement);t===0?maininput.focus():t>0&&n[t-1].focus()}}),document.getElementById("searchInput").onkeyup=function(){executeSearch(this.value)};function showSearchInput(){firstRun&&(loadSearch(),firstRun=!1),searchVisible?(document.getElementById("fastSearch").style.display="none",document.activeElement.blur(),searchVisible=!1):(document.getElementById("fastSearch").style.display="block",document.getElementById("searchInput").focus(),searchVisible=!0)}function fetchJSONFile(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===4&&n.status===200){var e=JSON.parse(n.responseText);t&&t(e)}},n.open("GET",e),n.send()}function loadSearch(){fetchJSONFile("/index.json",function(e){var t={includeMatches:!0,shouldSort:!0,ignoreLocation:!0,keys:[{name:"title",weight:1},{name:"content",weight:.6}]};fuse=new Fuse(e,t)})}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function cleanText(e){return e=e.replace(/\$\$[\s\S]*?\$\$/g,""),e=e.replace(/\$.*?\$/g,""),e=e.replace(/\\\[[\s\S]*?\\\]/g,""),e=e.replace(/\\\(.*?\\\)/g,""),e=e.replace(/\\[a-zA-Z]+\{.*?\}/g,""),e=e.replace(/[_^\\{}]/g,""),e=e.replace(/\s+/g," "),e=e.replace(/<section[^>]*>|<\/section>/g,""),e=e.replace(/<textarea[^>]*>|<\/textarea>/g,""),e=e.replace(/data-template/g,""),e.trim()}function executeSearch(e){if(e.length==0){document.getElementById("searchResults").setAttribute("style","");return}let t=fuse.search(e),n="";if(t.length===0)resultsAvailable=!1,n='<li class="noSearchResult">无结果</li>';else{const s=escapeRegExp(e);t.sort((e,t)=>{const n=new RegExp("\\b"+s+"\\b","i").test(cleanText(e.item.title)),o=new RegExp("\\b"+s+"\\b","i").test(cleanText(t.item.title)),i=e.item.content&&new RegExp("\\b"+s+"\\b","i").test(cleanText(e.item.content)),a=t.item.content&&new RegExp("\\b"+s+"\\b","i").test(cleanText(t.item.content));return n&&!o?-1:!n&&o?1:i&&!a?-1:!i&&a?1:0}),permalinkList=[],searchItemCount=0;for(let o in t){if(permalinkList.includes(t[o].item.permalink))continue;permalinkList.push(t[o].item.permalink),searchItemCount+=1;let i=cleanText(t[o].item.title);const a=t[o].item.permalink.includes("/slides/");let s="";if(a){{let n=[],i=-1,a=-1;if(t[o].matches.forEach((t)=>{if(t.key=="content"){const s=cleanText(t.value);if(s.trim()){const o=new RegExp("\\b"+escapeRegExp(e)+"\\b","i").test(s),t=o?2:s.toLowerCase().includes(e.toLowerCase())?1:0;t>a&&(a=t,i=n.length),n.push(s)}}}),n.length>0&&i!==-1){const o=Math.max(0,i-1),a=Math.min(n.length,i+2),r=n.slice(o,a);if(s=r.join(" ... "),s.length>200){const t=s.toLowerCase().indexOf(e.toLowerCase());if(t!==-1){const n=Math.max(0,t-100),o=Math.min(s.length,t+e.length+100);s=(n>0?"... ":"")+s.slice(n,o)+(o<s.length?" ...":"")}else s=s.slice(0,200)+" ..."}const t=[...s.matchAll(new RegExp(escapeRegExp(e),"gi"))];if(t.length>0){let e=0,n="";for(const o of t)n+=s.slice(e,o.index)+'<span class="search-highlight">'+o[0]+"</span>",e=o.index+o[0].length;n+=s.slice(e),s=n}}}}else for(const n of t[o].matches)if(n.key=="title"){{const t=[...i.matchAll(new RegExp(e,"gi"))];if(t.length>0){let e=0,n="";for(const s of t)n+=i.slice(e,s.index)+'<span class="search-highlight">'+s[0]+"</span>",e=s.index+s[0].length;n+=i.slice(e),i=n}}}else if(n.key=="content"){let t=cleanText(n.value);const o=[...t.matchAll(new RegExp(e,"gi"))];if(o.length>0){const e=o[0],n=Math.max(0,e.index-30),i=Math.min(t.length,e.index+e[0].length+30);s=(n>0?"...":"")+t.slice(n,e.index)+'<span class="search-highlight">'+e[0]+"</span>"+t.slice(e.index+e[0].length,i)+(i<t.length?"...":"")}}const r='<li><a href="'+t[o].item.permalink+'" tabindex="0" class="search-result-item"><span class="title">'+i+"</span>"+(s?'<br /> <span class="sc">'+s+"</span>":"")+"</a></li>";if(n+=r,searchItemCount>=5)break}resultsAvailable=!0}document.getElementById("searchResults").setAttribute("style","display: block;"),document.getElementById("searchResults").innerHTML=n,t.length>0&&(first=list.firstChild.firstElementChild,last=list.lastChild.firstElementChild)}